<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1f2937">
    <title>Referee Schedule Tracker</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
const { useState, useEffect } = React;
const { Plus, Trash2, DollarSign, Calendar, Users, ChevronLeft, ChevronRight, Bell, BellOff, Archive, Home } = lucide;

function RefereeScheduleApp() {
  const [games, setGames] = useState([]);
  const [archivedMonths, setArchivedMonths] = useState([]);
  const [showForm, setShowForm] = useState(false);
  const [viewMode, setViewMode] = useState('list');
  const [currentDate, setCurrentDate] = useState(new Date());
  const [notificationsEnabled, setNotificationsEnabled] = useState(false);
  const [notificationPermission, setNotificationPermission] = useState('default');
  const [showArchive, setShowArchive] = useState(false);
  const [formData, setFormData] = useState({
    league: '', date: '', time: '', facility: '', partner: '', numGames: 1, rate: ''
  });

  useEffect(() => {
    const saved = localStorage.getItem('refGames');
    const savedArchive = localStorage.getItem('refArchive');
    const savedNotifPref = localStorage.getItem('refNotificationsEnabled');
    if (saved) setGames(JSON.parse(saved));
    if (savedArchive) setArchivedMonths(JSON.parse(savedArchive));
    if (savedNotifPref) setNotificationsEnabled(savedNotifPref === 'true');
    if ('Notification' in window) setNotificationPermission(Notification.permission);
    
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js')
        .then(() => console.log('SW registered'))
        .catch(() => console.log('SW registration failed'));
    }
  }, []);

  useEffect(() => { localStorage.setItem('refGames', JSON.stringify(games)); }, [games]);
  useEffect(() => { localStorage.setItem('refArchive', JSON.stringify(archivedMonths)); }, [archivedMonths]);
  useEffect(() => { localStorage.setItem('refNotificationsEnabled', notificationsEnabled); }, [notificationsEnabled]);

  useEffect(() => {
    const now = new Date();
    now.setHours(0, 0, 0, 0);
    const pastGames = games.filter(g => new Date(g.date) < now);
    if (pastGames.length > 0) {
      const monthGroups = {};
      pastGames.forEach(game => {
        const date = new Date(game.date);
        const key = date.getFullYear() + '-' + date.getMonth();
        if (!monthGroups[key]) monthGroups[key] = { year: date.getFullYear(), month: date.getMonth(), games: [] };
        monthGroups[key].games.push(game);
      });
      const newArchives = Object.values(monthGroups).map(group => ({
        id: Date.now() + Math.random(),
        year: group.year,
        month: group.month,
        monthName: new Date(group.year, group.month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' }),
        games: group.games,
        total: group.games.reduce((sum, g) => sum + g.total, 0)
      }));
      if (newArchives.length > 0) {
        setArchivedMonths(prev => [...prev, ...newArchives].sort((a, b) => a.year !== b.year ? b.year - a.year : b.month - a.month));
        setGames(games.filter(g => new Date(g.date) >= now));
      }
    }
  }, [games]);

  const requestNotificationPermission = async () => {
    if (!('Notification' in window)) { alert('Browser does not support notifications'); return; }
    const permission = await Notification.requestPermission();
    setNotificationPermission(permission);
    if (permission === 'granted') {
      setNotificationsEnabled(true);
      new Notification('Notifications Enabled!', { body: 'You will receive reminders before games.' });
    } else {
      alert('Enable notifications in browser settings.');
    }
  };

  const toggleNotifications = () => {
    if (!notificationsEnabled && notificationPermission !== 'granted') {
      requestNotificationPermission();
    } else {
      setNotificationsEnabled(!notificationsEnabled);
    }
  };

  const addGame = () => {
    if (!formData.date || !formData.league) return;
    const newGame = {
      id: Date.now(),
      ...formData,
      numGames: Number(formData.numGames) || 1,
      rate: Number(formData.rate) || 0,
      total: (Number(formData.numGames) || 1) * (Number(formData.rate) || 0)
    };
    setGames([...games, newGame].sort((a, b) => new Date(a.date) - new Date(b.date)));
    setFormData({ league: '', date: '', time: '', facility: '', partner: '', numGames: 1, rate: '' });
    setShowForm(false);
  };

  const deleteGame = (id) => setGames(games.filter(g => g.id !== id));
  const totalEarnings = games.reduce((sum, g) => sum + g.total, 0);
  const archivedTotal = archivedMonths.reduce((sum, m) => sum + m.total, 0);
  
  const yearlyTotals = {};
  archivedMonths.forEach(m => { yearlyTotals[m.year] = (yearlyTotals[m.year] || 0) + m.total; });
  games.forEach(g => { const year = new Date(g.date).getFullYear(); yearlyTotals[year] = (yearlyTotals[year] || 0) + g.total; });

  const getDaysInMonth = (date) => {
    const year = date.getFullYear();
    const month = date.getMonth();
    return {
      daysInMonth: new Date(year, month + 1, 0).getDate(),
      startingDayOfWeek: new Date(year, month, 1).getDay(),
      year, month
    };
  };

  const getGamesForDate = (date) => {
    const dateStr = date.toISOString().split('T')[0];
    return games.filter(g => g.date === dateStr);
  };

  const previousMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1));
  const nextMonth = () => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1));

  const renderCalendar = () => {
    const { daysInMonth, startingDayOfWeek, year, month } = getDaysInMonth(currentDate);
    const days = [];
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    for (let i = 0; i < startingDayOfWeek; i++) {
      days.push(React.createElement('div', { key: 'empty-' + i, className: 'aspect-square p-1' }));
    }

    for (let day = 1; day <= daysInMonth; day++) {
      const date = new Date(year, month, day);
      const dateGames = getGamesForDate(date);
      const isToday = date.toDateString() === today.toDateString();

      days.push(
        React.createElement('div', {
          key: day,
          className: 'aspect-square p-1 border border-gray-700 ' + (isToday ? 'bg-blue-900 bg-opacity-30' : 'bg-gray-800')
        },
          React.createElement('div', { className: 'text-xs text-gray-400 mb-1' }, day),
          dateGames.length > 0 && React.createElement('div', { className: 'space-y-1' },
            dateGames.map(game =>
              React.createElement('div', {
                key: game.id,
                className: 'text-xs bg-blue-600 rounded px-1 py-0.5 truncate'
              }, (game.time ? game.time.slice(0, 5) : 'â€¢') + ' ' + game.league)
            ),
            dateGames.reduce((sum, g) => sum + g.total, 0) > 0 && 
            React.createElement('div', { className: 'text-xs text-green-400 font-semibold' }, 
              '$' + dateGames.reduce((sum, g) => sum + g.total, 0)
            )
          )
        )
      );
    }

    return React.createElement('div', { className: 'grid grid-cols-7 gap-1 text-sm' }, days);
  };

  if (showArchive) {
    return React.createElement('div', { className: 'min-h-screen bg-gray-900 text-white p-4' },
      React.createElement('div', { className: 'max-w-md mx-auto' },
        React.createElement('div', { className: 'flex justify-between items-center mb-6' },
          React.createElement('h1', { className: 'text-2xl font-bold' }, 'Archive'),
          React.createElement('button', {
            onClick: () => setShowArchive(false),
            className: 'bg-blue-600 p-2 rounded-lg'
          }, React.createElement(Home, { size: 20 }))
        ),
        
        React.createElement('div', { className: 'mb-6 p-4 bg-gray-800 rounded-lg' },
          React.createElement('div', { className: 'text-sm text-gray-400 mb-2' }, 'Total Archived Earnings'),
          React.createElement('div', { className: 'text-2xl font-bold text-green-400' }, '$' + archivedTotal)
        ),

        Object.keys(yearlyTotals).sort((a, b) => b - a).map(year =>
          React.createElement('div', { key: year, className: 'mb-4 p-4 bg-gray-800 rounded-lg' },
            React.createElement('div', { className: 'text-lg font-semibold mb-2' }, 
              year + ' Total: $' + yearlyTotals[year]
            ),
            React.createElement('div', { className: 'space-y-2' },
              archivedMonths.filter(m => m.year == year).map(month =>
                React.createElement('div', {
                  key: month.id,
                  className: 'flex justify-between items-center p-2 bg-gray-700 rounded'
                },
                  React.createElement('span', null, month.monthName + ' (' + month.games.length + ' games)'),
                  React.createElement('span', { className: 'text-green-400 font-semibold' }, '$' + month.total)
                )
              )
            )
          )
        ),

        archivedMonths.length === 0 && React.createElement('div', {
          className: 'text-center text-gray-400 mt-8'
        }, 'No archived data yet')
      )
    );
  }

  return React.createElement('div', { className: 'min-h-screen bg-gray-900 text-white' },
    React.createElement('div', { className: 'max-w-md mx-auto p-4' },
      React.createElement('div', { className: 'flex justify-between items-center mb-6' },
        React.createElement('h1', { className: 'text-2xl font-bold' }, 'Referee Schedule'),
        React.createElement('div', { className: 'flex space-x-2' },
          React.createElement('button', {
            onClick: toggleNotifications,
            className: 'p-2 rounded-lg ' + (notificationsEnabled ? 'bg-green-600' : 'bg-gray-600')
          }, React.createElement(notificationsEnabled ? Bell : BellOff, { size: 20 })),
          React.createElement('button', {
            onClick: () => setShowArchive(true),
            className: 'bg-purple-600 p-2 rounded-lg'
          }, React.createElement(Archive, { size: 20 }))
        )
      ),

      React.createElement('div', { className: 'grid grid-cols-2 gap-4 mb-6' },
        React.createElement('div', { className: 'bg-gray-800 p-4 rounded-lg' },
          React.createElement('div', { className: 'text-sm text-gray-400 mb-1' }, 'Upcoming Games'),
          React.createElement('div', { className: 'text-xl font-bold' }, games.length)
        ),
        React.createElement('div', { className: 'bg-gray-800 p-4 rounded-lg' },
          React.createElement('div', { className: 'text-sm text-gray-400 mb-1' }, 'Total Earnings'),
          React.createElement('div', { className: 'text-xl font-bold text-green-400' }, '$' + totalEarnings)
        )
      ),

      React.createElement('div', { className: 'flex mb-4 bg-gray-800 rounded-lg p-1' },
        React.createElement('button', {
          onClick: () => setViewMode('list'),
          className: 'flex-1 py-2 px-4 rounded-md text-center ' + (viewMode === 'list' ? 'bg-blue-600' : '')
        }, 'List'),
        React.createElement('button', {
          onClick: () => setViewMode('calendar'),
          className: 'flex-1 py-2 px-4 rounded-md text-center ' + (viewMode === 'calendar' ? 'bg-blue-600' : '')
        }, 'Calendar')
      ),

      viewMode === 'calendar' && React.createElement('div', { className: 'mb-6' },
        React.createElement('div', { className: 'flex justify-between items-center mb-4' },
          React.createElement('button', {
            onClick: previousMonth,
            className: 'p-2 bg-gray-700 rounded-lg'
          }, React.createElement(ChevronLeft, { size: 20 })),
          React.createElement('h2', { className: 'text-lg font-semibold' },
            currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
          ),
          React.createElement('button', {
            onClick: nextMonth,
            className: 'p-2 bg-gray-700 rounded-lg'
          }, React.createElement(ChevronRight, { size: 20 }))
        ),
        React.createElement('div', { className: 'grid grid-cols-7 gap-1 text-xs text-gray-400 mb-2' },
          ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day =>
            React.createElement('div', { key: day, className: 'text-center p-2' }, day)
          )
        ),
        renderCalendar()
      ),

      viewMode === 'list' && React.createElement('div', { className: 'space-y-3 mb-6' },
        games.length === 0 ? React.createElement('div', {
          className: 'text-center text-gray-400 py-8'
        }, 'No upcoming games scheduled') :
        games.map(game =>
          React.createElement('div', {
            key: game.id,
            className: 'bg-gray-800 p-4 rounded-lg'
          },
            React.createElement('div', { className: 'flex justify-between items-start mb-2' },
              React.createElement('div', null,
                React.createElement('div', { className: 'font-semibold' }, game.league),
                React.createElement('div', { className: 'text-sm text-gray-400' },
                  new Date(game.date).toLocaleDateString() + 
                  (game.time ? ' at ' + game.time : '')
                )
              ),
              React.createElement('button', {
                onClick: () => deleteGame(game.id),
                className: 'text-red-400 p-1'
              }, React.createElement(Trash2, { size: 16 }))
            ),
            game.facility && React.createElement('div', { className: 'text-sm text-gray-300 mb-1' }, 'ðŸ“ ' + game.facility),
            game.partner && React.createElement('div', { className: 'text-sm text-gray-300 mb-1' }, 'ðŸ‘¥ ' + game.partner),
            React.createElement('div', { className: 'flex justify-between items-center text-sm' },
              React.createElement('span', null, game.numGames + ' game' + (game.numGames !== 1 ? 's' : '') + ' @ $' + game.rate),
              React.createElement('span', { className: 'text-green-400 font-semibold' }, '$' + game.total)
            )
          )
        )
      ),

      !showForm && React.createElement('button', {
        onClick: () => setShowForm(true),
        className: 'fixed bottom-6 right-6 bg-blue-600 p-4 rounded-full shadow-lg'
      }, React.createElement(Plus, { size: 24 })),

      showForm && React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-end' },
        React.createElement('div', { className: 'bg-gray-800 w-full max-h-[80vh] overflow-y-auto rounded-t-lg p-6' },
          React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'Add New Game'),
          React.createElement('div', { className: 'space-y-4' },
            React.createElement('input', {
              type: 'text',
              placeholder: 'League/Organization *',
              value: formData.league,
              onChange: (e) => setFormData({...formData, league: e.target.value}),
              className: 'w-full p-3 bg-gray-700 rounded-lg text-white'
            }),
            React.createElement('input', {
              type: 'date',
              value: formData.date,
              onChange: (e) => setFormData({...formData, date: e.target.value}),
              className: 'w-full p-3 bg-gray-700 rounded-lg text-white'
            }),
            React.createElement('input', {
              type: 'time',
              value: formData.time,
              onChange: (e) => setFormData({...formData, time: e.target.value}),
              className: 'w-full p-3 bg-gray-700 rounded-lg text-white'
            }),
            React.createElement('input', {
              type: 'text',
              placeholder: 'Facility/Location',
              value: formData.facility,
              onChange: (e) => setFormData({...formData, facility: e.target.value}),
              className: 'w-full p-3 bg-gray-700 rounded-lg text-white'
            }),
            React.createElement('input', {
              type: 'text',
              placeholder: 'Partner Referee',
              value: formData.partner,
              onChange: (e) => setFormData({...formData, partner: e.target.value}),
              className: 'w-full p-3 bg-gray-700 rounded-lg text-white'
            }),
            React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
              React.createElement('input', {
                type: 'number',
                placeholder: 'Number of Games',
                value: formData.numGames,
                min: '1',
                onChange: (e) => setFormData({...formData, numGames: e.target.value}),
                className: 'p-3 bg-gray-700 rounded-lg text-white'
              }),
              React.createElement('input', {
                type: 'number',
                placeholder: 'Rate per Game ($)',
                value: formData.rate,
                min: '0',
                step: '0.01',
                onChange: (e) => setFormData({...formData, rate: e.target.value}),
                className: 'p-3 bg-gray-700 rounded-lg text-white'
              })
            ),
            React.createElement('div', { className: 'flex space-x-4 pt-4' },
              React.createElement('button', {
                onClick: () => setShowForm(false),
                className: 'flex-1 py-3 bg-gray-600 rounded-lg'
              }, 'Cancel'),
              React.createElement('button', {
                onClick: addGame,
                className: 'flex-1 py-3 bg-blue-600 rounded-lg disabled:opacity-50',
                disabled: !formData.league || !formData.date
              }, 'Add Game')
            )
          )
        )
      )
    )
  );
}

ReactDOM.render(React.createElement(RefereeScheduleApp), document.getElementById('root'));
    </script>
</body>
</html>
