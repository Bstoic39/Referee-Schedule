<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#111827" />
  <title>Referee Schedule</title>

  <link rel="manifest" href="site.webmanifest" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="icon" href="favicon.ico" />

  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white">
  <div id="root"></div>

  <!-- React (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script>
    const { useEffect, useMemo, useRef, useState } = React;

    // ---------- Date helpers ----------
    function pad2(n) { return String(n).padStart(2, '0'); }
    function toLocalDateKey(d) {
      return `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
    }
    function monthKeyFromDateKey(dateKey) { return dateKey.slice(0, 7); } // YYYY-MM

    function parseGameDateTime(game) {
      const [y, m, d] = game.date.split('-').map(Number);
      let hh = 0, mm = 0;
      if (game.time && /^\d{2}:\d{2}$/.test(game.time)) [hh, mm] = game.time.split(':').map(Number);
      return new Date(y, m - 1, d, hh, mm, 0, 0);
    }

    function formatNiceDate(dateKey) {
      const [y, m, d] = dateKey.split('-').map(Number);
      return new Date(y, m - 1, d).toLocaleDateString();
    }

    function formatNiceMonth(monthKey) {
      const [y, m] = monthKey.split('-').map(Number);
      return new Date(y, m - 1, 1).toLocaleDateString(undefined, { year: 'numeric', month: 'long' });
    }

    function startOfMonth(dateObj) { return new Date(dateObj.getFullYear(), dateObj.getMonth(), 1); }

    function getMonthGrid(dateObj) {
      const first = startOfMonth(dateObj);
      const firstDay = first.getDay(); // 0 Sun .. 6 Sat
      const gridStart = new Date(first);
      gridStart.setDate(first.getDate() - firstDay);

      const cells = [];
      for (let i = 0; i < 42; i++) {
        const d = new Date(gridStart);
        d.setDate(gridStart.getDate() + i);
        cells.push({ date: d, inMonth: d.getMonth() === dateObj.getMonth() });
      }
      return cells;
    }

    // ---------- Storage keys (STABLE) ----------
    const STORAGE_ACTIVE  = 'refGames_active';
    const STORAGE_ARCHIVE = 'refGames_archive'; // { "YYYY-MM": [games...] }

    // Migration: copy data from older keys if new keys are empty.
    function migrateStorageIfNeeded() {
      try {
        const hasNewActive = localStorage.getItem(STORAGE_ACTIVE);
        const hasNewArchive = localStorage.getItem(STORAGE_ARCHIVE);
        if (hasNewActive || hasNewArchive) return;

        const legacyActiveKeys = [
          'refGames_v7_active','refGames_v6_active','refGames_v5_active','refGames_v4_active','refGames_v3_active','refGames'
        ];
        const legacyArchiveKeys = [
          'refGames_v7_archive','refGames_v6_archive','refGames_v5_archive','refGames_v4_archive','refGames_v3_archive','refArchive'
        ];

        for (const k of legacyActiveKeys) {
          const v = localStorage.getItem(k);
          if (v) { localStorage.setItem(STORAGE_ACTIVE, v); break; }
        }
        for (const k of legacyArchiveKeys) {
          const v = localStorage.getItem(k);
          if (v) { localStorage.setItem(STORAGE_ARCHIVE, v); break; }
        }
      } catch (e) {
        console.warn('Storage migration failed', e);
      }
    }

    // ---------- Icons (inline SVG) ----------
    function TrashIcon({ className = '' }) {
      return React.createElement(
        'svg',
        { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className },
        React.createElement('polyline', { points: '3 6 5 6 21 6' }),
        React.createElement('path', { d: 'M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6' }),
        React.createElement('path', { d: 'M10 11v6' }),
        React.createElement('path', { d: 'M14 11v6' }),
        React.createElement('path', { d: 'M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2' })
      );
    }

    function WhistleIcon({ className = '' }) {
      return React.createElement(
        'svg',
        { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className },
        React.createElement('path', { d: 'M3 12h11a4 4 0 1 1 0 8H9a6 6 0 0 1-6-6z' }),
        React.createElement('circle', { cx: 19, cy: 16, r: 2 })
      );
    }

    function PencilIcon({ className = '' }) {
      return React.createElement(
        'svg',
        { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className },
        React.createElement('path', { d: 'M12 20h9' }),
        React.createElement('path', { d: 'M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z' })
      );
    }

    function CheckIcon({ className = '' }) {
      return React.createElement(
        'svg',
        { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, strokeLinecap: 'round', strokeLinejoin: 'round', className },
        React.createElement('path', { d: 'M20 6 9 17l-5-5' })
      );
    }

    // ---------- Long-press hook ----------
    function useLongPress({ onLongPress, onClick, ms = 500 }) {
      const timerRef = useRef(null);
      const longPressedRef = useRef(false);

      const start = (e) => {
        longPressedRef.current = false;
        if (timerRef.current) clearTimeout(timerRef.current);
        timerRef.current = setTimeout(() => {
          longPressedRef.current = true;
          onLongPress && onLongPress(e);
        }, ms);
      };

      const clear = (e) => {
        if (timerRef.current) {
          clearTimeout(timerRef.current);
          timerRef.current = null;
        }
      };

      const end = (e) => {
        clear(e);
        if (!longPressedRef.current) {
          onClick && onClick(e);
        }
      };

      return {
        onMouseDown: start,
        onMouseUp: end,
        onMouseLeave: clear,
        onTouchStart: start,
        onTouchEnd: end,
        onTouchCancel: clear
      };
    }

    function RefereeScheduleApp() {
      const [view, setView] = useState('list'); // list | calendar | archive
      const [activeGames, setActiveGames] = useState([]);
      const [archiveByMonth, setArchiveByMonth] = useState({});
      const [showForm, setShowForm] = useState(false);

      const [calendarCursor, setCalendarCursor] = useState(() => new Date());
      const [selectedDateKey, setSelectedDateKey] = useState(null);

      // editTarget: null | { scope: 'active'|'archived', monthKey?: 'YYYY-MM', gameId: number }
      const [editTarget, setEditTarget] = useState(null);

      const [formData, setFormData] = useState({
        league: '',
        date: '',
        time: '',
        facility: '',
        partner: '',
        numGames: 1,
        rate: ''
      });

      // ----- Load from storage (with migration) -----
      useEffect(() => {
        try {
          migrateStorageIfNeeded();

          const savedActive = localStorage.getItem(STORAGE_ACTIVE);
          const savedArchive = localStorage.getItem(STORAGE_ARCHIVE);

          if (savedActive) setActiveGames(JSON.parse(savedActive));
          if (savedArchive) setArchiveByMonth(JSON.parse(savedArchive));
        } catch (e) {
          console.warn('Failed to load storage', e);
        }
      }, []);

      // ----- Persist -----
      useEffect(() => { try { localStorage.setItem(STORAGE_ACTIVE, JSON.stringify(activeGames)); } catch {} }, [activeGames]);
      useEffect(() => { try { localStorage.setItem(STORAGE_ARCHIVE, JSON.stringify(archiveByMonth)); } catch {} }, [archiveByMonth]);

      // Jump calendar to today when switching to calendar tab
      useEffect(() => {
        if (view === 'calendar') {
          setCalendarCursor(new Date());
        }
      }, [view]);

      // ----- CRUD helpers -----
      function computeTotal(numGames, rate) {
        const ng = Number(numGames) || 0;
        const r = Number(rate) || 0;
        return ng * r;
      }

      function openAddForm(prefillDateKey) {
        setEditTarget(null);
        setFormData({
          league: '',
          date: prefillDateKey || '',
          time: '',
          facility: '',
          partner: '',
          numGames: 1,
          rate: ''
        });
        setShowForm(true);
      }

      function openEditActive(game) {
        setEditTarget({ scope: 'active', gameId: game.id });
        setFormData({
          league: game.league || '',
          date: game.date || '',
          time: game.time || '',
          facility: game.facility || '',
          partner: game.partner || '',
          numGames: game.numGames ?? 1,
          rate: game.rate ?? ''
        });
        setShowForm(true);
      }

      function openEditArchived(monthKey, game) {
        setEditTarget({ scope: 'archived', monthKey, gameId: game.id });
        setFormData({
          league: game.league || '',
          date: game.date || '',
          time: game.time || '',
          facility: game.facility || '',
          partner: game.partner || '',
          numGames: game.numGames ?? 1,
          rate: game.rate ?? ''
        });
        setShowForm(true);
      }

      function saveForm() {
        if (!formData.league || !formData.date) return;

        const next = {
          league: String(formData.league || '').trim(),
          date: formData.date,
          time: formData.time,
          facility: String(formData.facility || '').trim(),
          partner: String(formData.partner || '').trim(),
          numGames: Number(formData.numGames) || 1,
          rate: Number(formData.rate) || 0
        };

        next.total = computeTotal(next.numGames, next.rate);

        // ADD
        if (!editTarget) {
          const newGame = { id: Date.now(), ...next };
          setActiveGames(prev => [...prev, newGame].sort((a, b) => parseGameDateTime(a) - parseGameDateTime(b)));
          setShowForm(false);
          return;
        }

        // EDIT ACTIVE
        if (editTarget.scope === 'active') {
          const id = editTarget.gameId;
          setActiveGames(prev => prev
            .map(g => g.id === id ? { ...g, ...next } : g)
            .sort((a, b) => parseGameDateTime(a) - parseGameDateTime(b))
          );
          setShowForm(false);
          return;
        }

        // EDIT ARCHIVED (may move month if date changed)
        if (editTarget.scope === 'archived') {
          const oldMonthKey = editTarget.monthKey;
          const id = editTarget.gameId;
          const newMonthKey = monthKeyFromDateKey(next.date);

          setArchiveByMonth(prev => {
            const copy = { ...prev };
            const oldArr = (copy[oldMonthKey] || []).map(g => g);
            const idx = oldArr.findIndex(g => g.id === id);
            if (idx === -1) return prev;

            const updatedGame = { ...oldArr[idx], ...next };
            oldArr.splice(idx, 1);

            if (oldArr.length) copy[oldMonthKey] = oldArr;
            else delete copy[oldMonthKey];

            copy[newMonthKey] = (copy[newMonthKey] || []).concat([updatedGame]);
            copy[newMonthKey].sort((a, b) => parseGameDateTime(a) - parseGameDateTime(b));

            return copy;
          });

          setShowForm(false);
          return;
        }
      }

      function deleteActive(id) { setActiveGames(prev => prev.filter(g => g.id !== id)); }

      function deleteArchived(monthKey, id) {
        setArchiveByMonth(prev => {
          const next = { ...prev };
          next[monthKey] = (next[monthKey] || []).filter(g => g.id !== id);
          if (next[monthKey].length === 0) delete next[monthKey];
          return next;
        });
      }

      function markPaid(gameId) {
        // Move from active â†’ archive month bucket
        setActiveGames(prevActive => {
          const game = prevActive.find(g => g.id === gameId);
          if (!game) return prevActive;

          const remaining = prevActive.filter(g => g.id !== gameId);

          setArchiveByMonth(prevArchive => {
            const mk = monthKeyFromDateKey(game.date);
            const next = { ...prevArchive };
            next[mk] = (next[mk] || []).concat([{ ...game }]);
            next[mk].sort((a, b) => parseGameDateTime(a) - parseGameDateTime(b));
            return next;
          });

          return remaining;
        });
      }

      // ----- Derived maps -----
      const totalOwed = useMemo(() => (
        activeGames.reduce((sum, g) => sum + (Number(g.total) || 0), 0)
      ), [activeGames]);

      const totalPaid = useMemo(() => {
        let sum = 0;
        for (const mk of Object.keys(archiveByMonth)) {
          for (const g of (archiveByMonth[mk] || [])) sum += (Number(g.total) || 0);
        }
        return sum;
      }, [archiveByMonth]);

      const gamesByDateKey = useMemo(() => {
        const map = {};
        for (const g of activeGames) {
          map[g.date] = map[g.date] || [];
          map[g.date].push(g);
        }
        for (const k of Object.keys(map)) map[k].sort((a, b) => parseGameDateTime(a) - parseGameDateTime(b));
        return map;
      }, [activeGames]);

      const archivedGamesByDateKey = useMemo(() => {
        const map = {};
        for (const mk of Object.keys(archiveByMonth)) {
          for (const g of (archiveByMonth[mk] || [])) {
            map[g.date] = map[g.date] || [];
            map[g.date].push(g);
          }
        }
        for (const k of Object.keys(map)) map[k].sort((a, b) => parseGameDateTime(a) - parseGameDateTime(b));
        return map;
      }, [archiveByMonth]);

      const selectedActiveGames = useMemo(() => (
        selectedDateKey ? (gamesByDateKey[selectedDateKey] || []) : []
      ), [gamesByDateKey, selectedDateKey]);

      const selectedArchivedGames = useMemo(() => (
        selectedDateKey ? (archivedGamesByDateKey[selectedDateKey] || []) : []
      ), [archivedGamesByDateKey, selectedDateKey]);

      // ---------- UI helpers ----------
      const inputClass =
        "w-full mb-2 p-2 bg-gray-700 rounded outline-none focus:ring-2 focus:ring-blue-500";

      function TabButton({ id, label }) {
        const active = view === id;
        return React.createElement(
          'button',
          {
            onClick: () => {
              setView(id);
              if (id !== 'calendar') setSelectedDateKey(null);
            },
            className:
              (active ? 'bg-blue-600 text-white' : 'bg-gray-800 text-gray-200 hover:bg-gray-700') +
              ' px-3 py-2 rounded-lg text-sm font-semibold'
          },
          label
        );
      }

      function ActionIconButton({ title, className, onClick, icon }) {
        return React.createElement(
          'button',
          { onClick, title, className: (className || '') + ' p-1 rounded active:scale-95 transition' },
          icon
        );
      }

      function GameCard({ game, onEdit, onDelete, onMarkPaid, showMarkPaid }) {
        return React.createElement(
          'div',
          { className: 'bg-gray-800 p-4 rounded-lg mb-3' },

          React.createElement(
            'div',
            { className: 'flex justify-between items-start gap-3' },

            React.createElement(
              'div',
              { className: 'min-w-0' },
              React.createElement('div', { className: 'font-semibold text-lg truncate' }, game.league),
              React.createElement(
                'div',
                { className: 'text-sm text-gray-400 mb-1' },
                formatNiceDate(game.date) + (game.time ? ` @ ${game.time}` : '')
              ),
              (game.facility || game.partner)
                ? React.createElement(
                    'div',
                    { className: 'text-sm text-gray-300 mb-1' },
                    (game.facility ? `ðŸ“ ${game.facility}` : '') +
                    (game.facility && game.partner ? ' â€¢ ' : '') +
                    (game.partner ? `ðŸ¤ ${game.partner}` : '')
                  )
                : null
            ),

            React.createElement(
              'div',
              { className: 'flex items-center gap-2 shrink-0' },

              onEdit
                ? React.createElement(ActionIconButton, {
                    title: 'Edit',
                    className: 'text-gray-300 hover:text-white',
                    onClick: onEdit,
                    icon: React.createElement(PencilIcon, { className: 'w-5 h-5' })
                  })
                : null,

              showMarkPaid && onMarkPaid
                ? React.createElement(ActionIconButton, {
                    title: 'Mark Paid',
                    className: 'text-green-400 hover:text-green-300',
                    onClick: onMarkPaid,
                    icon: React.createElement(CheckIcon, { className: 'w-5 h-5' })
                  })
                : null,

              onDelete
                ? React.createElement(ActionIconButton, {
                    title: 'Delete',
                    className: 'text-red-400 hover:text-red-300',
                    onClick: onDelete,
                    icon: React.createElement(TrashIcon, { className: 'w-5 h-5' })
                  })
                : null
            )
          ),

          React.createElement(
            'div',
            { className: 'flex justify-between text-sm items-center mt-2' },
            React.createElement('span', null, `${game.numGames} game(s) @ $${game.rate}`),
            React.createElement('span', { className: 'text-green-400 font-semibold' }, `$${game.total}`)
          )
        );
      }

      function ListView() {
        return React.createElement(
          React.Fragment,
          null,
          React.createElement(
            'div',
            { className: 'grid grid-cols-2 gap-3 mb-4' },
            React.createElement(
              'div',
              { className: 'bg-gray-800 p-4 rounded-lg' },
              React.createElement('div', { className: 'text-sm text-gray-400' }, 'Owed (Active)'),
              React.createElement('div', { className: 'text-xl font-bold text-yellow-300' }, `$${totalOwed}`)
            ),
            React.createElement(
              'div',
              { className: 'bg-gray-800 p-4 rounded-lg' },
              React.createElement('div', { className: 'text-sm text-gray-400' }, 'Paid (Archive)'),
              React.createElement('div', { className: 'text-xl font-bold text-green-400' }, `$${totalPaid}`)
            )
          ),

          activeGames.length === 0
            ? React.createElement('div', { className: 'text-center text-gray-400 py-10' }, 'No active games (owed).')
            : activeGames.map(g =>
                React.createElement(GameCard, {
                  key: g.id,
                  game: g,
                  showMarkPaid: true,
                  onMarkPaid: () => markPaid(g.id),
                  onEdit: () => openEditActive(g),
                  onDelete: () => deleteActive(g.id)
                })
              )
        );
      }

      function CalendarDaySheet() {
        if (!selectedDateKey) return null;

        const hasAny = selectedActiveGames.length > 0 || selectedArchivedGames.length > 0;

        return React.createElement(
          'div',
          { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-end', onClick: () => setSelectedDateKey(null) },
          React.createElement(
            'div',
            {
              className: 'bg-gray-800 w-full p-6 rounded-t-2xl max-h-[75vh] overflow-y-auto',
              onClick: (e) => e.stopPropagation()
            },
            React.createElement(
              'div',
              { className: 'flex items-center justify-between mb-3' },
              React.createElement('div', { className: 'text-lg font-semibold' }, formatNiceDate(selectedDateKey)),
              React.createElement(
                'button',
                { className: 'text-sm bg-gray-700 hover:bg-gray-600 px-3 py-2 rounded', onClick: () => setSelectedDateKey(null) },
                'Close'
              )
            ),

            !hasAny
              ? React.createElement('div', { className: 'text-center text-gray-400 py-6' }, 'No games on this day.')
              : React.createElement(
                  React.Fragment,
                  null,

                  selectedActiveGames.length > 0
                    ? React.createElement(
                        React.Fragment,
                        null,
                        React.createElement('div', { className: 'text-sm text-gray-300 mb-2' }, 'Active (owed)'),
                        selectedActiveGames.map(g =>
                          React.createElement(GameCard, {
                            key: g.id,
                            game: g,
                            showMarkPaid: true,
                            onMarkPaid: () => markPaid(g.id),
                            onEdit: () => openEditActive(g),
                            onDelete: () => deleteActive(g.id)
                          })
                        )
                      )
                    : null,

                  selectedArchivedGames.length > 0
                    ? React.createElement(
                        React.Fragment,
                        null,
                        React.createElement('div', { className: 'text-sm text-gray-300 mt-4 mb-2' }, 'Archived (paid)'),
                        selectedArchivedGames.map(g =>
                          React.createElement(GameCard, {
                            key: g.id,
                            game: g,
                            showMarkPaid: false,
                            onEdit: () => openEditArchived(monthKeyFromDateKey(g.date), g),
                            onDelete: () => deleteArchived(monthKeyFromDateKey(g.date), g.id)
                          })
                        )
                      )
                    : null
                )
          )
        );
      }

      function CalendarView() {
        const cells = getMonthGrid(calendarCursor);
        const monthLabel = calendarCursor.toLocaleDateString(undefined, { month: 'long', year: 'numeric' });
        const todayKey = toLocalDateKey(new Date());

        function prevMonth() { setCalendarCursor(d => new Date(d.getFullYear(), d.getMonth() - 1, 1)); }
        function nextMonth() { setCalendarCursor(d => new Date(d.getFullYear(), d.getMonth() + 1, 1)); }

        const weekDays = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

        return React.createElement(
          'div',
          null,
          React.createElement(
            'div',
            { className: 'flex items-center justify-between mb-3' },
            React.createElement('button', { className: 'bg-gray-800 hover:bg-gray-700 px-3 py-2 rounded', onClick: prevMonth }, 'â€¹'),
            React.createElement('div', { className: 'font-semibold' }, monthLabel),
            React.createElement('button', { className: 'bg-gray-800 hover:bg-gray-700 px-3 py-2 rounded', onClick: nextMonth }, 'â€º')
          ),
          React.createElement(
            'div',
            { className: 'grid grid-cols-7 gap-1 mb-1 text-xs text-gray-400' },
            weekDays.map(w => React.createElement('div', { key: w, className: 'text-center py-1' }, w))
          ),
          React.createElement(
            'div',
            { className: 'grid grid-cols-7 gap-1' },
            cells.map((cell, idx) => {
              const dk = toLocalDateKey(cell.date);
              const dayNum = cell.date.getDate();

              const hasActive = (gamesByDateKey[dk] || []).length > 0;
              const hasArchived = (archivedGamesByDateKey[dk] || []).length > 0;
              const isToday = dk === todayKey;

              const pressBind = useLongPress({
                onLongPress: () => openAddForm(dk),
                onClick: () => setSelectedDateKey(dk),
                ms: 500
              });

              const baseClass = isToday
                ? 'bg-white text-gray-900'
                : (cell.inMonth ? 'bg-gray-800 text-white' : 'bg-gray-950 text-gray-400');

              // Distinguish unpaid (active) vs paid (archived) days:
              // - Active: green whistle
              // - Archived only: gray whistle
              const whistle =
                hasActive
                  ? React.createElement(WhistleIcon, { className: 'w-4 h-4' })
                  : (hasArchived ? React.createElement(WhistleIcon, { className: 'w-4 h-4' }) : null);

              const whistleColor =
                hasActive ? (isToday ? 'text-blue-600' : 'text-green-400') :
                (hasArchived ? (isToday ? 'text-blue-600' : 'text-gray-400') : '');

              return React.createElement(
                'button',
                Object.assign(
                  {
                    key: idx,
                    className:
                      baseClass +
                      ' rounded p-2 min-h-[72px] text-left border border-transparent ' +
                      ' hover:bg-gray-700 active:scale-[0.99] transition select-none'
                  },
                  pressBind
                ),
                React.createElement(
                  'div',
                  {
                    className:
                      (isToday
                        ? 'text-blue-600 font-semibold'
                        : (cell.inMonth ? 'text-gray-200' : 'text-gray-600')
                      ) + ' text-xs mb-1 flex justify-between'
                  },
                  React.createElement('span', null, dayNum),
                  whistle
                    ? React.createElement('span', { className: whistleColor + ' flex items-center justify-center' }, whistle)
                    : null
                )
              );
            })
          ),
          React.createElement(CalendarDaySheet)
        );
      }

      function ArchiveView() {
        const monthKeys = Object.keys(archiveByMonth).sort().reverse();
        return React.createElement(
          'div',
          null,
          monthKeys.length === 0
            ? React.createElement('div', { className: 'text-center text-gray-400 py-10' }, 'Archive is empty (paid games).')
            : monthKeys.map(mk => {
                const games = archiveByMonth[mk] || [];
                const monthTotal = games.reduce((s, g) => s + (Number(g.total) || 0), 0);

                return React.createElement(
                  'div',
                  { key: mk, className: 'mb-6' },
                  React.createElement(
                    'div',
                    { className: 'flex items-baseline justify-between mb-2' },
                    React.createElement('div', { className: 'font-semibold text-lg' }, formatNiceMonth(mk)),
                    React.createElement('div', { className: 'text-green-400 font-semibold' }, `$${monthTotal}`)
                  ),
                  games.map(g =>
                    React.createElement(GameCard, {
                      key: g.id,
                      game: g,
                      showMarkPaid: false,
                      onEdit: () => openEditArchived(mk, g),
                      onDelete: () => deleteArchived(mk, g.id)
                    })
                  )
                );
              })
        );
      }

      // ----- Main render -----
      return React.createElement(
        'div',
        { className: 'min-h-screen p-4 max-w-md mx-auto pb-24' },

        React.createElement('h1', { className: 'text-2xl font-bold mb-4 text-center' }, 'Referee Schedule'),

        React.createElement(
          'div',
          { className: 'flex gap-2 justify-center mb-4' },
          React.createElement(TabButton, { id: 'list', label: 'List' }),
          React.createElement(TabButton, { id: 'calendar', label: 'Calendar' }),
          React.createElement(TabButton, { id: 'archive', label: 'Archive' })
        ),

        view === 'list'
          ? React.createElement(ListView)
          : view === 'calendar'
            ? React.createElement(CalendarView)
            : React.createElement(ArchiveView),

        // Expanded Add button (only in List view)
        view === 'list' &&
          React.createElement(
            'button',
            {
              onClick: () => openAddForm(''),
              className:
                'fixed bottom-6 left-1/2 -translate-x-1/2 bg-blue-600 hover:bg-blue-500 px-6 py-3 rounded-full shadow-lg font-semibold flex items-center gap-2'
            },
            React.createElement('span', { className: 'text-xl leading-none' }, '+'),
            'Add Game'
          ),

        showForm &&
          React.createElement(
            'div',
            { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-end' },
            React.createElement(
              'div',
              { className: 'bg-gray-800 w-full p-6 rounded-t-2xl' },

              React.createElement('h2', { className: 'text-xl font-bold mb-4' }, editTarget ? 'Edit Game' : 'Add Game'),

              React.createElement('input', {
                placeholder: 'League *',
                className: inputClass,
                value: formData.league,
                onChange: e => setFormData({ ...formData, league: e.target.value })
              }),

              React.createElement('input', {
                type: 'date',
                className: inputClass,
                value: formData.date,
                onChange: e => setFormData({ ...formData, date: e.target.value })
              }),

              React.createElement('input', {
                type: 'time',
                className: inputClass,
                value: formData.time,
                onChange: e => setFormData({ ...formData, time: e.target.value })
              }),

              React.createElement('input', {
                placeholder: 'Facility',
                className: inputClass,
                value: formData.facility,
                onChange: e => setFormData({ ...formData, facility: e.target.value })
              }),

              React.createElement('input', {
                placeholder: 'Partner',
                className: inputClass,
                value: formData.partner,
                onChange: e => setFormData({ ...formData, partner: e.target.value })
              }),

              React.createElement('input', {
                type: 'number',
                min: 1,
                placeholder: 'Number of games',
                className: inputClass,
                value: formData.numGames,
                onChange: e => setFormData({ ...formData, numGames: e.target.value })
              }),

              React.createElement('input', {
                type: 'number',
                min: 0,
                step: '0.01',
                placeholder: 'Rate (per game)',
                className: inputClass,
                value: formData.rate,
                onChange: e => setFormData({ ...formData, rate: e.target.value })
              }),

              React.createElement(
                'div',
                { className: 'flex gap-2 mt-2' },
                React.createElement(
                  'button',
                  { className: 'flex-1 bg-gray-600 hover:bg-gray-500 p-2 rounded', onClick: () => setShowForm(false) },
                  'Cancel'
                ),
                React.createElement(
                  'button',
                  { className: 'flex-1 bg-blue-600 hover:bg-blue-500 p-2 rounded', onClick: saveForm },
                  editTarget ? 'Save' : 'Add'
                )
              ),

              React.createElement(
                'div',
                { className: 'mt-3 text-xs text-gray-400 text-center' },
                view === 'calendar'
                  ? 'Tip: Long-press a day to add a game on that date.'
                  : ''
              )
            )
          )
      );
    }

    ReactDOM.render(
      React.createElement(RefereeScheduleApp),
      document.getElementById('root')
    );
  </script>
</body>
</html>
